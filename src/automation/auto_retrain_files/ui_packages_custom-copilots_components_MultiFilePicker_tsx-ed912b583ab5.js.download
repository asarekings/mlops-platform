"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([["ui_packages_custom-copilots_components_MultiFilePicker_tsx"],{78904:(e,t,a)=>{a.d(t,{T:()=>d});var n=a(17908),r=a(5796),i=a(46584),l=a(70404),o=a(57572),s=a(96540),c=a(46636);function d(){let{sendAnalyticsEvent:e}=(0,l.s)(),t=function(){let e=function(){let e=(0,n.t)(),t=(0,c.i)();return(0,s.useMemo)(()=>({react_app:"code-view",repository_id:e.id,repository_nwo:`${e.ownerLogin}/${e.name}`,repository_public:e.public,repository_is_fork:e.isFork,actor_id:t?.id,actor_login:t?.login}),[e,t])}(),t=(0,n.t)(),a=(0,r.yH8)(r.tTz,{owner:t.ownerLogin,repo:t.name});return(0,s.useCallback)((t,n,r)=>{let i={target:t,interaction:n,context:r,...e,url:window.location.href,user_agent:window.navigator.userAgent,browser_width:window.innerWidth,browser_languages:window.navigator.languages.join(",")};(0,o.lS)(a,{method:"POST",body:i})},[e,a])}(),a=(0,i.u)("code_nav_ui_events");return{sendRepoClickEvent:(0,s.useCallback)((n,r={})=>{e("repository.click",n,r),a&&t(n,"click",r)},[e,t,a]),sendRepoKeyDownEvent:(0,s.useCallback)((n,r={})=>{e("repository.keydown",n,r),a&&t(n,"keydown",r)},[e,t,a]),sendStats:(0,s.useCallback)((n,r={})=>{e(n,"",r),a&&t(n,"stats",r)},[e,t,a]),sendMarketplaceActionEvent:(0,s.useCallback)((t,a={})=>{e("marketplace.action.click",t,a)},[e])}}},83023:(e,t,a)=>{a.d(t,{o:()=>u});var n=a(5225),r=a(17908),i=a(5796),l=a(57572),o=a(96540);async function s(e){let t=await (0,l.lS)(e);return t.ok?await t.json():void 0}let c=new Map,d=(0,n.A)(s,{cache:c});function u(e,t,a){let n=(0,r.t)(),[l,s]=(0,o.useState)({list:[],directories:[],loading:!0}),c=(0,i.ClY)({repo:n,commitOid:e,includeDirectories:!a});return(0,o.useEffect)(()=>{let e=!1,a=async()=>{s({list:[],directories:[],loading:!0});let t=await d(c);if(e)return;let a=t?.paths||[],n=t?.directories||[];s({list:a.concat(n).sort(),directories:n,error:!t})};return t&&a(),function(){e=!0}},[c,t,a]),l}},38556:(e,t,a)=>{a.d(t,{Z:()=>s});var n=a(14194),r=a(17908),i=a(5796),l=a(94232),o=a(96540);function s(){let e=(0,r.t)(),{path:t,action:a,refInfo:s}=(0,n.eu)(),[c]=(0,l.I)(()=>!1,!0,[]);function d(e){return e?`?${e}`:""}function u(e){return c?"":void 0===e?window.location.hash:e?`#${e}`:""}return{getItemUrl:o.useCallback(t=>(0,i.IO9)({repo:e,commitish:s.name,action:"directory"===t.contentType?"tree":"blob",path:t.path}),[e.ownerLogin,e.name,s.name]),getUrl(n={}){let r=(0,i.IO9)({repo:e,commitish:n.commitish||s.name,action:n.action||a,path:n.path||t})+function({params:e,hash:t}){return d(e)+u(t)}(n);return n.absolute?new URL(r,window.location.origin).href:r},createPermalink(n={}){let r=(0,i.IO9)({repo:e,commitish:s.currentOid,action:n.action||a,path:n.path||t})+function({params:e,hash:t}){return d(e)+u(t)}(n);return n.absolute?new URL(r,window.location.origin).href:r},isCurrentPagePermalink:()=>!c&&s.name===s.currentOid&&window.location.pathname.includes(s.currentOid)}}},73412:(e,t,a)=>{function n(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}a.d(t,{z:()=>WebWorker});let WebWorker=class WebWorker{set onmessage(e){this.worker.onmessage=e}postMessage(e){this.worker.postMessage(e)}terminate(){this.worker.terminate()}constructor(e,t){n(this,"worker",void 0);try{this.worker=new Worker(`${e}?module=true`,{type:"module"})}catch{console.warn("Web workers are not available. Please enable web workers to benefit from the improved performance."),this.worker=new MainThreadWorker(t)}}};let MainThreadWorker=class MainThreadWorker{async postMessage(e){if(this.terminated)return;let t={data:this.job({data:e})};this.onmessage?.(t)}terminate(){this.terminated=!0}constructor(e){n(this,"terminated",!1),n(this,"onmessage",void 0),this.job=e}}},7911:(e,t,a)=>{a.d(t,{j:()=>l});var n=a(5225),r=a(91385);let i=(0,n.A)(r.fN);function l({data:e}){let{query:t,baseList:a,startTime:n}=e,l=t.replaceAll("\\","");return{query:t,list:a.filter(e=>""===l||(0,r.qA)(l,e)&&i(l,e)>0).sort((e,t)=>i(l,t)-i(l,e)),baseCount:a.length,startTime:n}}},41980:(e,t,a)=>{a.d(t,{U:()=>d});var n=a(62562),r=a(10833),i=a(96540),l=a(18312),o=a(65615),s=a(7426),c=a(68956);function d(e,t,a,d){let[m,h]=(0,i.useState)(void 0),p=(0,i.useCallback)(()=>h(void 0),[]),{topRepositoriesCache:f,currentRepository:x}=(0,o.Pk)(),y=(0,s.b)(),[g,v]=(0,i.useState)([]),[C,b]=(0,i.useState)(!f&&"initial"),j=(0,i.useRef)(void 0),w=(0,l.useRelayEnvironment)(),S=(0,l.useFragment)(r.Sy,m??null),I=d&&""!==d.trim();if(S&&!f&&!e){let{topRepositories:e}=S,t=u((e.edges||[]).flatMap(e=>e?.node?[(0,l.readInlineData)(r.R6,e.node)]:[])),{ownerLogin:a,name:n}=x??{};x&&!t.find(e=>`${e.ownerLogin}/${e.name}`==`${a}/${n}`)&&t.splice(0,0,{databaseId:x.id,isInOrganization:"Organization"===x.ownerType,name:x.name,nwo:`${x.ownerLogin}/${x.name}`,ownerLogin:x.ownerLogin,ownerAvatarUrl:`/${x.ownerLogin}.png?s=40`}),setTimeout(()=>y.setTopRepositoryTopics(t),10),b(!1),h(void 0)}let R=(0,i.useCallback)(async()=>{try{let e=await (0,l.fetchQuery)(w,r.m,{topRepositoriesFirst:a,owner:I?d:null}).toPromise();h(e?.viewer)}catch{}finally{b(!1)}},[I,d,w,h,a]);return((0,i.useEffect)(()=>{t&&R()},[R,t,d]),(0,i.useEffect)(()=>{let t=async e=>{b(!0);let t=((await new Promise((t,a)=>{(0,l.fetchQuery)(w,r.XD,{searchQuery:I?(0,c.rl)(d,e):(0,n.J)(e)}).subscribe({start:e=>{j.current?.unsubscribe(),j.current=e},next:e=>{t(e)},error:e=>{a(e)}})})).search.nodes||[]).flatMap(e=>e?[(0,l.readInlineData)(r.R6,e)]:[]);v(t.length?u(t):[]),b(!1)};e?t(e):f&&v(f)},[e,I,d,w,f]),(0,i.useEffect)(()=>{y.setTopRepositoryTopics(void 0)},[y,d]),f&&!e)?{repositories:f,loading:!1,resetTopRepoResults:p}:{repositories:g,loading:C,resetTopRepoResults:p}}function u(e){return e.map(({owner:{login:e,avatarUrl:t},isInOrganization:a,name:n,databaseId:r})=>({databaseId:r??0,isInOrganization:a,name:n,nwo:`${e}/${n}`,ownerLogin:e,ownerAvatarUrl:t}))}},1750:(e,t,a)=>{a.d(t,{O:()=>n});function n(e,t){let a={};for(let n of e){let e=t(n);a[e]??(a[e]=[]),a[e].push(n)}return a}},62562:(e,t,a)=>{a.d(t,{J:()=>n});function n(e){let t=e.indexOf("/");if(-1===t||0===t)return`${e} in:name archived:false`;let a=e.slice(0,t),n=e.slice(t+1);return 0===n.length?`org:${a} in:name archived:false`:`org:${a} ${n} in:name archived:false`}},70404:(e,t,a)=>{a.d(t,{S:()=>s,s:()=>o});var n=a(21728),r=a(96540),i=a(46988),l=a(50045);function o(){let e,t;let a=(0,n.c)(6),o=(0,r.useContext)(l.I);if(!o)throw Error("useAnalytics must be used within an AnalyticsContext");let{appName:s,category:c,metadata:d}=o;a[0]!==s||a[1]!==c||a[2]!==d?(e=(e,t,a)=>{let n={react:!0,app_name:s,category:c,...d};(0,i.BI)(e,{...n,...void 0===a?{}:a,target:t})},a[0]=s,a[1]=c,a[2]=d,a[3]=e):e=a[3];let u=e;return a[4]!==u?(t={sendAnalyticsEvent:u},a[4]=u,a[5]=t):t=a[5],t}function s(){let e,t;let a=(0,n.c)(4),{sendAnalyticsEvent:r}=o();a[0]!==r?(e=e=>{r("analytics.click",void 0,void 0===e?{}:e)},a[0]=r,a[1]=e):e=a[1];let i=e;return a[2]!==i?(t={sendClickAnalyticsEvent:i},a[2]=i,a[3]=t):t=a[3],t}},28448:(e,t,a)=>{a.d(t,{Z:()=>r});var n=a(96540);function r({focusRowRef:e,mouseRowRef:t}){let[a,r]=n.useState(!1);return n.useEffect(()=>{if(e.current&&t.current){let a=()=>{let t=e.current?.querySelector(".PRIVATE_TreeView-item-content-text");t?.scrollWidth!==t?.offsetWidth&&r(!0)};e.current.onfocus=()=>{a()},e.current.onblur=()=>{r(!1)},t.current.onmouseenter=()=>{a()},t.current.onmouseleave=()=>{r(!1)}}},[e,t]),a}},6262:(e,t,a)=>{a.d(t,{E:()=>i});var n=a(74848),r=a(69197);function i({children:e}){return(0,r.P)()?(0,n.jsx)(n.Fragment,{children:e}):null}try{i.displayName||(i.displayName="AllShortcutsEnabled")}catch{}},69197:(e,t,a)=>{a.d(t,{$:()=>l,P:()=>o});var n=a(74848),r=a(96540);let i=r.createContext(!0);function l({allShortcutsEnabled:e,children:t}){return(0,n.jsxs)(i.Provider,{value:e,children:[" ",t," "]})}function o(){return r.useContext(i)}try{i.displayName||(i.displayName="AllShortcutsEnabledContext")}catch{}try{l.displayName||(l.displayName="AllShortcutsEnabledProvider")}catch{}},23832:(e,t,a)=>{a.d(t,{Ck:()=>o,JS:()=>l});var n=a(74848),r=a(96540);let i=(0,r.createContext)({query:"",setQuery:()=>void 0});function l(){return(0,r.useContext)(i)}function o({children:e}){let[t,a]=(0,r.useState)(""),l=(0,r.useMemo)(()=>({query:t,setQuery:a}),[a,t]);return(0,n.jsx)(i.Provider,{value:l,children:e})}try{i.displayName||(i.displayName="FileQueryContext")}catch{}try{o.displayName||(o.displayName="FileQueryProvider")}catch{}},14194:(e,t,a)=>{a.d(t,{eu:()=>s,qV:()=>o,sq:()=>c});var n=a(74848),r=a(38359),i=a(96540);let l=i.createContext({});function o({children:e,...t}){return(0,n.jsx)(l.Provider,{value:t,children:e})}function s(){return i.useContext(l)}function c(){return(0,r.X)()}try{l.displayName||(l.displayName="FilesPageInfoContext")}catch{}try{o.displayName||(o.displayName="FilesPageInfoProvider")}catch{}},89401:(e,t,a)=>{a.d(t,{Cb:()=>p,Dq:()=>c,E5:()=>s,Gj:()=>d,UJ:()=>x,cB:()=>m,f1:()=>u,hl:()=>f,zc:()=>h});var n=a(74848),r=a(16255),i=a(75177),l=a(89323),o=a(96540);let s="copilotChatMenuPortalRoot",c="copilotChatMessagesMenuPortalRoot",d="copilotChatPortalRoot",u="copilotChatTopicPickerPortalRoot",m=()=>{let e=(0,o.useRef)(null);return(0,o.useEffect)(()=>{(0,r.c)(e.current,d)},[]),(0,n.jsx)(i.A,{ref:e,sx:{position:"absolute",top:0,right:0,zIndex:100}})},h=()=>{let e=(0,o.useRef)(null);return(0,o.useEffect)(()=>{(0,r.c)(e.current,s)},[]),(0,n.jsx)(i.A,{ref:e,sx:{position:"absolute",top:0,right:0}})},p=()=>{let e=(0,o.useRef)(null);return(0,o.useEffect)(()=>{(0,r.c)(e.current,c)},[]),(0,n.jsx)("div",{ref:e})},f=()=>{let e=(0,o.useRef)(null);return(0,o.useEffect)(()=>{(0,r.c)(e.current,u)},[]),(0,n.jsx)("div",{ref:e})},x=({children:e,portalContainerName:t,...a})=>{let[r,i]=(0,o.useState)(()=>"undefined"!=typeof document);return((0,o.useEffect)(()=>i(!0),[]),r)?(0,n.jsx)(l.W.Overlay,{...a,portalContainerName:t||s,children:e}):null};try{m.displayName||(m.displayName="ChatPortalContainer")}catch{}try{h.displayName||(h.displayName="MenuPortalContainer")}catch{}try{p.displayName||(p.displayName="MessagesPortalContainer")}catch{}try{f.displayName||(f.displayName="TopicPickerPortalContainer")}catch{}try{x.displayName||(x.displayName="ActionMenuOverlay")}catch{}},61818:(e,t,a)=>{a.d(t,{Ee:()=>C,FZ:()=>b,X1:()=>j});var n=a(74848),r=a(46988),i=a(37824),l=a(53949),o=a(15385),s=a(61597),c=a(34164),d=a(96540),u=a(40961),m=a(41980),h=a(1750),p=a(82610),f=a(37937),x=a(65615),y=a(7426),g=a(89401),v=a(59010);function C(e){let{selectedThreadID:t,currentTopic:a}=(0,x.Pk)(),r=(0,y.b)(),i=(0,d.useCallback)(async e=>{f.J.setSelectedTopic(t??"",e.toString()),r.clearCurrentReferences(["image","issue"]),await r.fetchCurrentRepo(e)},[r,t]);return(0,n.jsx)(j,{...e,selectionVariant:"instant",selectedRepoIds:new Set(a?[a.id]:[]),onSelectRepo:i,description:"Choose a repository to chat about."})}function b(e){let{currentReferences:t}=(0,x.Pk)(),a=(0,y.b)(),r=t.filter(e=>"repository"===e.type),i=new Set(r.map(e=>e.id)),[l,o]=(0,d.useState)(),s=async t=>{o(void 0);let n=r.find(e=>e.id===t);if(n){a.removeReference(n);return}let i=await a.service.fetchRepo(t);if(!i.ok){o("Error: failed to attach repository. Please try again."),e.onOpenChange(!0);return}let l=(0,p.qS)(i.payload);a.addReference(l,"repoMenu")};return(0,n.jsx)(j,{...e,selectionVariant:"multiple",selectedRepoIds:i,onSelectRepo:s,description:"Choose repositories to chat about.",error:l})}function j({open:e,onOpenChange:t,submitReturnFocusRef:a,cancelReturnFocusRef:p,selectedRepoIds:f,featuredRepoIds:y=f,onSelectRepo:C,selectionVariant:b,description:j,error:w,ownerDisplayLogin:S}){let{ssoOrganizations:I}=(0,x.Pk)(),[R,N]=(0,d.useState)("");(0,d.useEffect)(()=>{e||N("")},[e]);let{repositories:k,loading:E}=(0,m.U)(R,e,void 0,S),T=(0,d.useMemo)(()=>E?"Loading repositories":0===k.length?"No repositories found":1===k.length?"1 repository found":`${k.length} repositories found`,[E,k.length]),A=(0,d.useMemo)(()=>I?I.map(e=>e.login):[],[I]),{featuredRepos:O,nonFeaturedRepos:F}=(0,h.O)(k,e=>y.has(e.databaseId)?"featuredRepos":"nonFeaturedRepos"),[P,_]=(0,d.useState)(!1),$=async e=>{_(!0),await C(e),_(!1)};return(0,n.jsx)("div",{...(0,l.G)("repo-select-panel"),children:(0,n.jsxs)(s.X,{width:"large",maxHeight:"xlarge",onCancel:()=>{(0,u.flushSync)(()=>t(!1)),p.current?.focus(),(0,r.BI)("dotcom_chat.activate",{target:"REPOSITORY_DIALOG_CLOSE",mode:"immersive"})},onSubmit:()=>{(0,u.flushSync)(()=>t(!1)),a.current?.focus()},open:e,variant:"modal",selectionVariant:b,title:"multiple"===b?"Select repositories":"Select a repository",description:j,children:[(0,n.jsx)(s.X.Header,{className:(0,c.$)(A.length>0&&"border-bottom-0"),children:(0,n.jsx)(s.X.SearchInput,{loading:!0===E||P,onChange:e=>{N(e.currentTarget.value)},placeholder:"Search repositories","aria-label":"Search repositories"})}),""===S&&(0,n.jsx)(n.Fragment,{children:(0,n.jsx)(i.x,{portalContainerName:g.f1,protectedOrgs:A,redirectURI:()=>`/search/refresh_blackbird_caches?return_to=${location.href}`,useFullWidthStyle:!0})}),(0,n.jsx)(g.hl,{}),w&&(0,n.jsx)(s.X.Message,{variant:"error",size:"inline",children:w}),(0,n.jsxs)(o.l,{sx:{minHeight:340},children:[(0,n.jsx)("div",{role:"status",className:"sr-only",children:T}),"initial"===E?(0,n.jsx)(s.X.Loading,{children:"Fetching repositories\u2026"}):0!==k.length||E?(0,n.jsxs)(n.Fragment,{children:[O?.map(e=>n.jsx(v.W,{repo:e,onSelect:$,selected:f.has(e.databaseId)},e.databaseId)),O&&F&&(0,n.jsx)(o.l.Divider,{}),F?.map(e=>n.jsx(v.W,{repo:e,onSelect:$,selected:f.has(e.databaseId)},e.databaseId))]}):(0,n.jsx)(s.X.Message,{variant:"empty",title:"No repositories found",children:"Try a different search term"})]})]})})}try{C.displayName||(C.displayName="RepoTopicSelectPanel")}catch{}try{b.displayName||(b.displayName="RepoReferencesSelectPanel")}catch{}try{j.displayName||(j.displayName="RepoSelectPanel")}catch{}},59010:(e,t,a)=>{a.d(t,{W:()=>l});var n=a(74848),r=a(62456),i=a(15385);function l({onSelect:e,repo:t,selected:a,trailingVisualComponent:l}){let{databaseId:o,isInOrganization:s,nwo:c,ownerAvatarUrl:d}=t;return(0,n.jsxs)(i.l.Item,{onSelect:()=>e(o),selected:a,children:[(0,n.jsx)(i.l.LeadingVisual,{children:(0,n.jsx)(r.r,{src:d,square:s,size:16})}),c,l&&(0,n.jsx)(i.l.TrailingVisual,{children:l})]},c)}try{l.displayName||(l.displayName="RepositoryListItem")}catch{}},17908:(e,t,a)=>{a.d(t,{d:()=>o,t:()=>s});var n=a(74848),r=a(21728),i=a(96540);let l=i.createContext({});function o(e){let t;let a=(0,r.c)(3),{repository:i,children:o}=e;return a[0]!==o||a[1]!==i?(t=(0,n.jsxs)(l.Provider,{value:i,children:[" ",o," "]}),a[0]=o,a[1]=i,a[2]=t):t=a[2],t}function s(){return i.useContext(l)}try{l.displayName||(l.displayName="CurrentRepositoryContext")}catch{}try{o.displayName||(o.displayName="CurrentRepositoryProvider")}catch{}},46636:(e,t,a)=>{a.d(t,{Q:()=>o,i:()=>s});var n=a(74848),r=a(21728),i=a(96540);let l=i.createContext(void 0);function o(e){let t;let a=(0,r.c)(3),{user:i,children:o}=e;return a[0]!==o||a[1]!==i?(t=(0,n.jsxs)(l.Provider,{value:i,children:[" ",o," "]}),a[0]=o,a[1]=i,a[2]=t):t=a[2],t}function s(){return i.useContext(l)}try{l.displayName||(l.displayName="CurrentUserContext")}catch{}try{o.displayName||(o.displayName="CurrentUserProvider")}catch{}},79786:(e,t,a)=>{a.d(t,{Q:()=>ev});var n=a(74848),r=a(75177),i=a(87330),l=a(27331),o=a(73451),s=a(55847),c=a(6869),d=a(38621),u=a(57572),m=a(96540),h=a(83023),p=a(78904),f=a(38556),x=a(7284),y=a(28448),g=a(46928),v=a(61003),C=a(65607),b=a(63867),j=a(30729),w=a(65556);function S(e,t,a){let n=[];for(let r of t)if(r.startsWith(e)){let t=r.slice(e.length+1),i=t.indexOf("/"),l=i>0?t.slice(0,i):t,o=`${e}/${l}`;if(a&&a.some(e=>e.path===o))continue;let s={items:[],data:{contentType:o===r?"file":"directory",name:l,path:o,isClientOnly:!0}};n.push(s)}return n}let I={checkbox:"FileTreePicker-module__checkbox--xtwO6",itemContainer:"FileTreePicker-module__itemContainer--yiAEi"};function R(e,t){let a=new Set(e);switch(t.type){case"SELECT_FILE":a.add(t.path);break;case"DESELECT_FILE":a.delete(t.path);break;case"SELECT_DIRECTORY":for(let e of t.paths)a.add(e);break;case"DESELECT_DIRECTORY":for(let e of t.paths)a.delete(e)}return a}function N({isActive:e,file:t,onItemSelected:a,getItemUrl:r,selectedItemRef:i,navigate:l,onRenderRow:o,getFileTrailingVisual:s,getFileIcon:c,navigateOnClick:u,isSelected:h}){let{sendRepoClickEvent:f}=(0,p.T)(),g=m.useRef(null),b=(0,y.Z)({focusRowRef:g,mouseRowRef:g}),j="submodule"===t.data.contentType,w=s?.(t.data);(0,m.useEffect)(()=>{e&&g.current&&requestAnimationFrame(()=>{g.current?.scrollIntoView({block:"center"})})},[e]);let S=m.useCallback(e=>{j?(e.preventDefault(),t.data.submoduleUrl&&(window.location.href=t.data.submoduleUrl)):e.metaKey||e.ctrlKey||1===e.button?(window.open(r(t.data),"_blank"),e.preventDefault()):(a?.(t.data,t),f("FILES_TREE.ITEM",{item_path:t.data.path}),u&&l(r(t.data)),e.stopPropagation())},[t,r,j,l,u,a,f]);return o?.(),(0,n.jsxs)(v.G.Item,{ref:g,onSelect:S,current:e,id:`${t.data.path}-item`,containIntrinsicSize:e?void 0:"auto 2rem",children:[(0,n.jsx)(v.G.LeadingVisual,{children:c?c(t.data):j?(0,n.jsx)(d.FileSubmoduleIcon,{}):(0,n.jsx)(d.FileIcon,{})}),(0,n.jsxs)("div",{className:I.itemContainer,children:[(0,n.jsx)(C.A,{className:I.checkbox,checked:h||!1,readOnly:!0,"aria-label":`Select ${t.data.name}`}),(0,n.jsx)("span",{ref:i,style:{color:j?"var(--fgColor-accent, var(--color-accent-fg))":void 0},children:(0,n.jsx)("span",{"data-testid":`${t.data.path}-file-item`,children:t.data.name})})]}),b&&(0,n.jsx)(x.m,{"data-testid":`${t.data.name}-item-tooltip`,id:`${t.data.name}-item-tooltip`,contentRef:g,"aria-label":t.data.name,open:!0,direction:"ne"}),!!w?.screenReaderText&&(0,n.jsx)("span",{className:"sr-only",children:w.screenReaderText}),!!w?.trailingVisual&&(0,n.jsx)(v.G.TrailingVisual,{children:w.trailingVisual})]})}let k=m.memo(N),E=m.memo(C.A);function T({clientOnlyFilePaths:e,directory:t,isActive:a,isAncestorOfActive:r,leadingPath:i,onItemSelected:l,getItemUrl:o,getFetchUrl:s,selectedItemRef:c,navigate:d,onRenderRow:h,getFileTrailingVisual:f,getFileIcon:g,navigateOnClick:C,selectedChildren:b,expandedPath:j}){let[R,N]=(0,m.useState)(r),{sendRepoClickEvent:k}=(0,p.T)(),T=m.useRef(null),A=m.useRef(null),O=(0,y.Z)({focusRowRef:A,mouseRowRef:T}),P=m.useMemo(()=>b?.filter(e=>e.startsWith(`${t.data.path}/`)),[b,t.data.path]),$=m.useMemo(()=>(function(e,t){if(!t||0===t.length)return"none";if(t.includes(e.data.path))return"all";let a=e.data.totalCount||0,n=t.filter(t=>t.startsWith(`${e.data.path}/`)).length;return 0===n?"none":n===a?"all":"partial"})(t,b),[t,b]),[L,D,M,W,V,U,z]=function(e,t,a){let[n,r]=m.useState(e.items),[i,l]=m.useState(e.data.totalCount||0),[o,s]=m.useState(!1),[c,d]=m.useState(!1),{safeSetTimeout:h}=(0,w.A)();m.useEffect(()=>{r(e.items)},[e.items]),m.useEffect(()=>{void 0!==e.data.totalCount&&l(e.data.totalCount)},[e.data.totalCount]);let p=m.useCallback(()=>{d(!1)},[]),f=m.useCallback((e,t)=>{let a=e||[...n];r(a.slice(0,100)),h(()=>{r(a),void 0!==t&&l(t)},1)},[n,h]);return[m.useCallback(async n=>{let i=new Map;if(e.data.isClientOnly){if(n){let a=S(e.data.path,n);for(let e of a)i.set(e.data.path,e);t({type:"add",folders:i,processingTime:0}),a.length>100?f(a,a.length):(r(a),l(a.length))}}else{let o=a(e.data);d(!1),s(!0);let c=Date.now(),m=await (0,u.lS)(`${o}?noancestors=1`);try{if(m.ok){let a=await m.json(),o=a.payload.tree.items.map(e=>{let t={items:[],data:{...e},autoExpand:"directory"===e.contentType&&1===a.payload.tree.items.length};return(i.set(e.path,t),e.hasSimplifiedPath)?function e(t,a,n){t.data.name=t.data.name.slice(t.data.name.lastIndexOf("/")+1,t.data.name.length);let r=a.name.slice(0,a.name.lastIndexOf("/")),i=r.indexOf("/")>-1,l={path:a.path.slice(0,a.path.lastIndexOf("/")),contentType:a.contentType,name:r,hasSimplifiedPath:i},o={items:[t],data:l};return(n.set(l.path,o),i)?e(o,{...l},n):o}(t,e,i):t});if(n){let t=e.data.path,r=S(t,n,a.payload.tree.items);for(let e of(o.push(...r),r))i.set(e.data.path,e)}t({type:"add",folders:i,processingTime:Date.now()-c}),e.items=o,e.data.totalCount=a.payload.tree.totalCount,o.length>100?f(o,a.payload.tree.totalCount):(r(o),l(a.payload.tree.totalCount))}else d(!0)}catch{d(!0)}}s(!1)},[a,e,t,f]),f,n,o,c,p,i]}(t,()=>{},s),B=i?`${i}/`:"",G=z-M.length;(0,m.useEffect)(()=>{a&&T.current&&requestAnimationFrame(()=>{T.current?.scrollIntoView({block:"center"})})},[a]);let q=m.useCallback(e=>{!e||R||W||V||!(t.items.length>100)||D(),e!==R&&N(e)},[R,W,V,t.items.length,D]),H=m.useCallback(e=>{e.metaKey||e.ctrlKey||1===e.button&&C?(window.open(o(t.data),"_blank"),e.preventDefault()):(l?.(t.data,t),k("FILES_TREE.ITEM",{item_path:t.data.path}),C&&d(o(t.data)),e.stopPropagation())},[t,o,d,C,l,k]);m.useEffect(()=>{r&&!R&&q?.(!0)},[r]),m.useEffect(()=>{0===t.items.length&&R?q?.(!1):!R&&t.autoExpand&&q?.(!0)},[t.items.length]);let K=m.useCallback(e=>{c&&a&&c(e),T.current=e},[c,a]);if(1===t.items.length){let r=t.items[0];if(r&&"directory"===r.data.contentType)return(0,n.jsx)(F,{clientOnlyFilePaths:e,directoryItems:t.items,leadingPath:B+t.data.name,inheritsActive:a,onItemSelected:l,selectedItemRef:c,getItemUrl:o,directoryNavigateOnClick:C,navigateOnClick:C,getFileTrailingVisual:f,getFileIcon:g,selectedChildren:P,expandedPath:j})}return h?.(),(0,n.jsxs)(v.G.Item,{ref:A,expanded:R,onExpandedChange:q,current:a,onSelect:H,id:`${t.data.path}-item`,containIntrinsicSize:a?void 0:"auto 2rem",children:[(0,n.jsx)(v.G.LeadingVisual,{children:(0,n.jsx)(v.G.DirectoryIcon,{})}),(0,n.jsxs)("div",{className:I.itemContainer,children:[(0,n.jsx)(E,{className:I.checkbox,checked:"all"===$,indeterminate:"partial"===$,readOnly:!0,"aria-label":`Select ${t.data.name}`,"data-indeterminate":"partial"===$?"true":void 0}),(0,n.jsxs)("span",{ref:K,children:[B&&(0,n.jsx)("span",{children:B}),(0,n.jsx)("span",{"data-testid":`${t.data.path}-directory-item`,children:t.data.name})]})]}),O&&(0,n.jsx)(x.m,{"data-testid":`${t.data.name}-directory-item-tooltip`,id:`${t.data.name}-directory-item-tooltip`,contentRef:A,"aria-label":`${B}${t.data.name}`,open:!0,direction:"ne"}),(0,n.jsx)(v.G.SubTree,{state:W?"loading":V?"error":"done",children:V?(0,n.jsx)(v.G.ErrorDialog,{onRetry:L,onDismiss:U,children:"There was an error loading the folder contents."}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(F,{clientOnlyFilePaths:e,directoryItems:M,onItemSelected:l,selectedItemRef:c,getItemUrl:o,directoryNavigateOnClick:C,navigateOnClick:C,getFileTrailingVisual:f,getFileIcon:g,selectedChildren:P,expandedPath:j}),G>0&&(0,n.jsx)(_,{message:`${G} entries not shown`})]})})]})}let A=m.memo(T,(e,t)=>e.isActive===t.isActive&&e.isAncestorOfActive===t.isAncestorOfActive&&e.directory===t.directory&&(e.selectedChildren===t.selectedChildren||0===e.selectedChildren.length&&0===t.selectedChildren.length)&&e.expandedPath===t.expandedPath);function O({clientOnlyFilePaths:e,directoryItems:t,leadingPath:a,inheritsActive:r,onItemSelected:i,selectedItemRef:l,onRenderRow:o,getItemUrl:s,getFileTrailingVisual:c,getFileIcon:d,directoryNavigateOnClick:u,navigateOnClick:h,selectedChildren:p,expandedPath:x}){let y=(0,f.Z)(),v=(0,g.Z)(),C=m.useRef(v),b=m.useRef(i);m.useEffect(()=>{b.current=i,C.current=v},[i,v]);let j=m.useCallback((e,t)=>{b.current?.(e,t)},[]),w=m.useMemo(()=>t.map(t=>{let i=x===t.data.path,m=p?.includes(t.data.path),f=i||x.startsWith(`${t.data.path}/`),g=p?.filter(e=>e===t.data.path||e.startsWith(`${t.data.path}/`));return"directory"===t.data.contentType?(0,n.jsx)(A,{clientOnlyFilePaths:e,isActive:r||i,isAncestorOfActive:f,onItemSelected:j,leadingPath:a,directory:t,getItemUrl:s,getFetchUrl:y.getItemUrl,selectedItemRef:f?l:void 0,navigate:v,onRenderRow:o,navigateOnClick:u,getFileTrailingVisual:c,getFileIcon:d,itemCount:t.items.length,isSelected:m,selectedChildren:g,expandedPath:x},t.data.name):(0,n.jsx)(k,{onItemSelected:j,file:t,isActive:i,getItemUrl:s,selectedItemRef:i?l:void 0,navigate:v,navigateOnClick:h,onRenderRow:o,getFileTrailingVisual:c,getFileIcon:d,isSelected:m},t.data.name)}),[t,x,p,e,r,j,a,s,y.getItemUrl,l,v,o,u,c,d,h]);return(0,n.jsx)(n.Fragment,{children:w})}let F=m.memo(O);function P(e){let{clientOnlyFilePaths:t,rootItems:a,fetchError:i,loading:l,onRenderRow:o,getItemUrl:s,getFileTrailingVisual:c,getFileIcon:d,expandedPath:u,onSelectionChange:h}=e,[p,f]=(0,m.useReducer)(R,new Set),x=e.selectedItems||p,y=(0,m.useCallback)(e=>{let t=new Set;if(t.add(e.data.path),"directory"===e.data.contentType)for(let a of e.items)for(let e of y(a))t.add(e);return Array.from(t)},[]),g=(0,m.useCallback)((e,t)=>{let a=t?{type:"DESELECT_FILE",path:e}:{type:"SELECT_FILE",path:e};h?h(R(x,a)):f(a)},[h,x]),C=(0,m.useCallback)((e,t)=>{let a=y(e),n=t?{type:"DESELECT_DIRECTORY",paths:a}:{type:"SELECT_DIRECTORY",paths:a};h?h(R(x,n)):f(n)},[y,h,x]),j=(0,m.useCallback)((e,t)=>{if("directory"===e.contentType){let e=y(t).every(e=>x.has(e));C(t,e)}else g(e.path,x.has(e.path))},[y,C,g,x]),w=(0,m.useCallback)(e=>{1===e.button&&e.preventDefault()},[]);return(0,n.jsx)(r.A,{onMouseDown:w,sx:{flexGrow:1,display:"flex",flexDirection:"column",...e.sx},"data-testid":"repos-file-tree-container",children:l?(0,n.jsxs)(r.A,{sx:{display:"flex",flexGrow:1,justifyContent:"center",alignItems:"center",flexDirection:"column",gap:3},children:[(0,n.jsx)(b.A,{"aria-label":"Loading file tree"}),(0,n.jsx)("span",{className:"fgColor-muted",children:"Fetching files..."})]}):(0,n.jsx)("nav",{"aria-label":"File Tree Navigation",children:(0,n.jsxs)(v.G,{"aria-label":"Files",children:[i&&(0,n.jsx)(_,{message:"Some files could not be loaded."}),(0,n.jsx)(F,{clientOnlyFilePaths:t,directoryItems:a,onItemSelected:j,selectedChildren:x?Array.from(x):[],selectedItemRef:e.selectedItemRef,onRenderRow:o,directoryNavigateOnClick:e.directoryNavigateOnClick,navigateOnClick:e.navigateOnClick,getItemUrl:s,getFileTrailingVisual:c,getFileIcon:d,expandedPath:u})]})})})}function _({message:e}){return(0,n.jsxs)(v.G.Item,{id:"error-tree-row",children:[(0,n.jsx)(v.G.LeadingVisual,{children:(0,n.jsx)(j.A,{icon:d.AlertFillIcon,sx:{color:"attention.fg"}})}),(0,n.jsx)(r.A,{sx:{color:"fg.muted"},children:e||"Couldn't load."})]})}try{N.displayName||(N.displayName="WrappedFileTreeRow")}catch{}try{k.displayName||(k.displayName="FileTreeRow")}catch{}try{E.displayName||(E.displayName="MemoizedCheckbox")}catch{}try{T.displayName||(T.displayName="WrappedDirectoryTreeRow")}catch{}try{A.displayName||(A.displayName="DirectoryTreeRow")}catch{}try{O.displayName||(O.displayName="WrappedDirectoryContents")}catch{}try{F.displayName||(F.displayName="DirectoryContents")}catch{}try{P.displayName||(P.displayName="FileTreePicker")}catch{}try{_.displayName||(_.displayName="ErrorTreeRow")}catch{}var $=a(61818),L=a(17908),D=a(23832),M=a(14194),W=a(69197),V=a(53949),U=a(73412),z=a(7911),B=a(69252),G=a(5796),q=a(17774),H=a(61663),K=a(69676),X=a(82678),Q=a(15385),Z=a(85349),Y=a(91385),J=a(70170),ee=a(6262),et=a(47584),ea=a(9591);let en=m.forwardRef(({ariaActiveDescendant:e,ariaControls:t,ariaExpanded:a,ariaHasPopup:i,onBlur:l,onFocus:o,onKeyDown:s,onPreload:c,onSearch:u,query:h,searchPlaceholder:f,loading:x,sx:y},g)=>{let{sendRepoClickEvent:v}=(0,p.T)(),[C,b]=m.useState(h),j=m.useRef((0,J.s)(e=>u(e),250));m.useEffect(()=>{b(h)},[h]);let w=h?(0,n.jsx)(ea.A.Action,{onClick:()=>{v("FILE_TREE.CANCEL_SEARCH"),u("")},icon:d.XCircleFillIcon,"aria-label":"Clear",className:"fgColor-muted"}):void 0;return(0,n.jsx)(ea.A,{autoFocus:er(),ref:g,value:C,onKeyDown:s,onChange:e=>{b(e.target.value),c(),j.current(e.target.value)},sx:{display:"flex",...y},"aria-label":f||"Go to file","aria-activedescendant":e,role:i?"combobox":void 0,"aria-controls":t,"aria-expanded":a,"aria-haspopup":i?"dialog":void 0,autoCorrect:"off",spellCheck:"false",placeholder:f||"Go to file",loading:""!==h&&x,leadingVisual:d.SearchIcon,trailingAction:w,trailingVisual:w?void 0:()=>(0,n.jsx)(ee.E,{children:(0,n.jsx)(r.A,{sx:{mr:"-6px"},children:(0,n.jsx)("kbd",{children:"t"})})}),onFocus:e=>{c(),e.target.select(),o?.(e)},onBlur:l,onClick:()=>v("FILE_TREE.SEARCH_BOX")})});function er(){return"1"===new URLSearchParams(et.fV.search).get("search")}en.displayName="FilesSearchBox";let ei={excludeDirectories:!1,excludeSeeAllResults:!1};function el({actionListSx:e,additionalResults:t,commitOid:a,config:i=ei,findFileWorkerPath:l,getItemUrl:o,onRenderRow:s,onItemSelected:d,searchBoxRef:u,sx:x}){let{excludeDirectories:y,excludeSeeAllResults:v}=i,{query:C,setQuery:b}=(0,D.JS)(),j=(0,L.t)(),w=m.useRef(null),S=u??w,[I,R]=m.useState(C.length>0),[N,k]=m.useState(!!C),{list:E,directories:T,loading:A,error:O}=(0,h.o)(a,I,!!y),{path:F}=(0,M.eu)(),{getUrl:P}=(0,f.Z)(),{queryText:_,queryLine:$}=function(e){let t=(e=e.replaceAll(" ","")).indexOf(":");return t>=0?{queryText:e.substring(0,t),queryLine:parseInt(e.substring(t+1),10)}:{queryText:e,queryLine:void 0}}(C),{matches:W,clearMatches:V}=function(e,t,a,n){let[r,i]=m.useState(),l=m.useRef(""),o=m.useRef(),{sendStats:s}=(0,p.T)(),c=m.useRef(!1),d=m.useCallback(()=>{let e=new U.z(a,z.j);e.onmessage=({data:e})=>{c.current=!1,i(e.list),l.current=e.query,e.startTime&&s("repository.find-file",{"find-file-base-count":e.baseCount,"find-file-results-count":e.list.length,"find-file-duration-ms":performance.now()-e.startTime})},o.current=e},[s,a]);return m.useEffect(()=>{if(n)return d(),function(){o.current?.terminate()}},[d,n]),m.useEffect(()=>{if(e.length&&t){c.current&&(o.current?.terminate(),d());let a=l.current&&t.startsWith(l.current);c.current=!0,o.current?.postMessage({baseList:a&&r||e,query:t,startTime:performance.now()})}},[e,t,d]),{matches:r,clearMatches:()=>i(void 0)}}((0,m.useMemo)(()=>[...E,...t??[]].sort(),[t,E]),_,l,I),{sendRepoClickEvent:q}=(0,p.T)(),Y=(0,g.Z)(),[J,ee]=m.useState(0),[et,ea]=m.useState(()=>er()),el=m.useRef(null),eo=m.useRef(null),es="file-results-list",{sendRepoKeyDownEvent:ec}=(0,p.T)(),{screenSize:eu}=(0,H.lm)(),em=i.enableOverlay??eu>=H.Gy.large,eh=m.useCallback(e=>{q("FILE_TREE.SEARCH_RESULT_CLICK"),d?.(e),k(!1)},[q,d]),ep=(e,t,a)=>o?o(e,t,a):P({path:e,action:t?"tree":"blob",hash:a}),{containerRef:ef}=(0,X.G)({bindKeys:K.z0.ArrowVertical|K.z0.HomeAndEnd,focusInStrategy:"previous"},[A,O]);m.useEffect(()=>{C||k(!1)},[C]),m.useEffect(()=>{document.activeElement!==S.current&&em&&k(!1)},[F,S,em]);let ex=W?.slice(0,20)||[],ey=W&&W.length>ex.length,eg=!i.disableNavigation,ev=eo.current?.getBoundingClientRect().width,eC=(0,n.jsx)(r.A,{sx:{maxHeight:em?"180px":"100% !important",overflowY:"auto",scrollbarGutter:"stable",maxWidth:"100vw",width:em?ev:"100%"},children:O?(0,n.jsx)(c.A,{variant:"danger",className:"m-3",children:"Failed to search"}):(0,n.jsxs)(Q.l,{ref:ef,sx:{overflow:"auto",p:em?2:3,width:"100%",pr:em?3:0,pt:em?3:"2px !important",...e},role:"listbox",children:[!A&&ex.map((e,t)=>{let a=T.includes(e),r=ep(e,a,$?`L${$}`:"");return(0,n.jsx)(ed,{active:!1,index:t,focused:et&&J===t,match:e,onRender:s,query:_,onClick:eh,isDirectory:a,to:r,useOverlay:em,listRef:ef,noAnchor:i.disableNavigation},e)}),0===ex.length&&(0,n.jsx)("div",{role:"status",className:"text-center fgColor-muted",children:"No matches found"})]})});return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(r.A,{ref:eo,sx:{...x},children:(0,n.jsx)(en,{ariaActiveDescendant:(!em&&C||em&&N)&&et&&J>-1?ey&&J===ex.length?"see-all-results-link":`file-result-${J}`:void 0,ariaExpanded:em?N:void 0,ariaHasPopup:em,ariaControls:em?es:void 0,ref:S,loading:A,query:C,onKeyDown:e=>{let{key:t,shiftKey:a,metaKey:n,altKey:r,ctrlKey:i}=e;if(!a&&!n&&!r){if("Escape"===t)C?(ec("FILE_TREE.CANCEL_SEARCH"),b(""),V()):document.activeElement&&document.activeElement.blur();else if(!C)return;else if("Enter"===t){if(!v&&ey&&J===ex.length)eg&&Y((0,G.Y8Y)({owner:j.ownerLogin,repo:j.name,searchTerm:`path:${_}`})),d?.();else if(ex[J]){let e=ex[J];eg&&Y(ep(ex[J],!1,$?`L${$}`:"")),k(!1),d?.(e)}}else if("ArrowDown"===t||i&&"n"===t){if(!v&&ey&&J>=ex.length-1){if(ee(ex.length),el.current&&ef.current){let e=(0,B.U)(ef.current);(0,K.Rt)(el.current,e,{behavior:"instant"})}}else ee(Math.min(J+1,ex.length-1));e.preventDefault();return}else if("ArrowUp"===t||i&&"p"===t){ee(Math.max(J-1,0)),e.preventDefault();return}}},onPreload:()=>R(!0),onSearch:e=>{b(e),e?k(!0):(V(),k(!1)),ee(0)},onBlur:e=>{ef.current?.contains(e.relatedTarget)||(k(!1),ea(!1))},onFocus:()=>{C&&k(!0),ea(!0)},searchPlaceholder:i.searchPlaceholder,sx:{minWidth:"160px"}})}),em&&ex.length>0&&(0,n.jsx)(Z.T,{anchorRef:eo,open:em&&N,renderAnchor:null,onClose:()=>{k(!1)},focusZoneSettings:{disabled:!0},focusTrapSettings:{disabled:!0},align:"end",overlayProps:{id:es,role:"dialog"},children:eC}),!em&&C&&eC]})}let eo=({active:e,focused:t,index:a,match:r,query:i,to:l,isDirectory:o,onClick:s,onRender:c,useOverlay:d,listRef:u,noAnchor:h})=>{let p=(0,Y.Xq)(i,r);c?.();let f=m.useRef(null);m.useEffect(()=>{if(t&&f.current&&u?.current){let e=(0,B.U)(u.current);(0,K.Rt)(f.current,e,{behavior:"instant"})}},[t,u]);let x={};t&&(x={outline:"none",border:"2 solid",boxShadow:"0 0 0 2px #0969da"});let y={id:`file-result-${a}`,active:e,onSelect:(0,m.useCallback)(()=>{s?.(r)},[r,s]),sx:{fontWeight:"normal",":hover":{textDecoration:"none"},mx:"2px",width:"calc(100% - 4px)",...x},role:"option","data-focus-visible-added":t||void 0,tabIndex:d?-1:0},g=(0,n.jsx)("div",{className:"d-flex",children:(0,n.jsx)("div",{className:"d-flex flex-1 flex-column overflow-hidden",children:(0,n.jsx)(eu,{text:r,positionsList:p,sx:{color:"fg.muted"},LeadingIcon:o?es:ec})})});return h?(0,m.createElement)(Q.l.Item,{...y,key:r},g):(0,m.createElement)(Q.l.Item,{...y,ref:f,as:q.N,to:l,key:r},g)},es=()=>(0,n.jsx)(j.A,{"aria-label":"Directory",icon:d.FileDirectoryFillIcon,sx:{color:"var(--treeViewItem-leadingVisual-iconColor-rest, var(--color-icon-directory))",mr:2},size:"small"}),ec=()=>(0,n.jsx)(j.A,{"aria-label":"File",icon:d.FileIcon,className:"fgColor-muted mr-2",size:"small"}),ed=m.memo(eo);function eu({text:e,positionsList:t,sx:a,LeadingIcon:i}){let l=[],o=0;for(let a of t){if(Number(a)!==a||a<o||a>e.length)continue;let t=e.slice(o,a);t&&l.push(em(t)),o=a+1,l.push((0,n.jsx)("mark",{className:"text-bold bgColor-transparent fgColor-default",children:e[a]},a))}return l.push(em(e.slice(o))),(0,n.jsx)(r.A,{sx:a,children:(0,n.jsxs)(n.Fragment,{children:[i&&(0,n.jsx)(i,{}),l]})})}function em(e){return e.replaceAll("/","/\u200B")}try{el.displayName||(el.displayName="FileResultsList")}catch{}try{eo.displayName||(eo.displayName="FileResultRow")}catch{}try{es.displayName||(es.displayName="DirectoryIcon")}catch{}try{ec.displayName||(ec.displayName="FileResultIcon")}catch{}try{ed.displayName||(ed.displayName="MemoizedFileResultRow")}catch{}try{eu.displayName||(eu.displayName="HighlightMatch")}catch{}var eh=a(26556);let ep={dialogHeader:"MultiFilePicker-module__dialogHeader--s9wHL"};var ef=a(2622),ex=a(44968);function ey({currentRepo:e,setLocalFormData:t,fetchError:a,onFileCountChange:i,processingTime:l,expandedPath:o}){let[s,c]=(0,m.useState)(()=>new Set),[d,u]=(0,m.useState)(()=>new Set),{list:p,directories:f,loading:x}=(0,h.o)(e.commitOID,!0),[y,g]=(0,m.useState)([]);(0,m.useEffect)(()=>{g(function e(t,a){let n=t[a];return n?n.items.map(a=>({data:a,items:"directory"===a.contentType?e(t,a.path):[]})).sort((e,t)=>"directory"===e.data.contentType&&"directory"!==t.data.contentType?-1:"directory"!==e.data.contentType&&"directory"===t.data.contentType?1:e.data.name.localeCompare(t.data.name)):[]}(function(e){let{paths:t,directories:a}=e,n={},r=new Set(a);for(let e of(n[""]={items:[],totalCount:0},[...a].sort())){let t=e.substring(0,e.lastIndexOf("/"))||"",a={name:e.substring(e.lastIndexOf("/")+1),path:e,contentType:"directory"};n[t]||(n[t]={items:[],totalCount:0}),n[t].items.push(a),n[e]||(n[e]={items:[],totalCount:0})}for(let e of t.filter(e=>!r.has(e)).sort()){let t=e.substring(0,e.lastIndexOf("/"))||"",a={name:e.substring(e.lastIndexOf("/")+1),path:e,contentType:"file"};n[t]||(n[t]={items:[],totalCount:0}),n[t].items.push(a)}for(let e in n){let t=n[e];t&&t.items.sort((e,t)=>"directory"===e.contentType&&"directory"!==t.contentType?-1:"directory"!==e.contentType&&"directory"===t.contentType?1:e.name.localeCompare(t.name))}let i=e=>{let t=n[e];return t?t.items.reduce((e,t)=>"directory"===t.contentType?e+1+i(t.path):e+1,0):0};for(let e in n){let t=n[e];t&&(t.totalCount=i(e))}return n}({paths:p,directories:f}),"")),u(new Set(f))},[p,f,g,e.commitOID]),(0,m.useEffect)(()=>{let a=Array.from(s).filter(e=>!d.has(e));i?.(a.length),t(a.map(t=>({id:`${e.id}-${t}`,repositoryId:e.id,nwo:`${e.ownerLogin}/${e.name}`,filePath:t,type:"github_file"})))},[s,d,e,t,i]);let v=(0,m.useCallback)(t=>`/${e.name}/${e.ownerLogin}/tree/${e.refInfo.name}/${t.path}`,[e]);return(0,n.jsx)(n.Fragment,{children:(0,n.jsx)(r.A,{sx:{flexGrow:1,maxHeight:"100% !important",minHeight:"300px",overflowY:"auto",scrollbarGutter:"stable",display:"flex",flexDirection:"column"},children:(0,n.jsx)(P,{rootItems:y,expandedPath:o,selectedItemRef:()=>{},setRootItems:g,navigateOnClick:!1,directoryNavigateOnClick:!1,selectedItems:s,onSelectionChange:c,processingTime:l,loading:x||!1,fetchError:!!a,getItemUrl:v,sortDirectoryItems:e=>e.sort((e,t)=>e.data.name.localeCompare(t.data.name))})})})}function eg({onClose:e}){return(0,n.jsx)(i.K,{icon:d.XIcon,"aria-label":"Close",onClick:e,variant:"invisible"})}function ev({formData:e,onCancel:t,onSave:a,findFileWorkerPath:r,attachmentButtonRef:h,openRepoPanel:p,owner:f}){let[x,y]=(0,m.useState)({}),[g,v]=(0,m.useState)(null),[C,b]=(0,m.useState)(null),[j,w]=(0,m.useState)(p),[S,I]=(0,m.useState)(e),[R]=(0,m.useState)(0),[N,k]=(0,m.useState)(!1),[E,T]=(0,m.useState)(null),[A,O]=(0,m.useState)(""),[F,P]=(0,m.useState)(0),_=(0,m.useRef)(!1),U=async e=>{let t;if(_.current=!0,x[e]){b(t=x[e]);return}try{let a=await (0,u.lS)(`/github-copilot/chat/repositories/${e}`,{method:"GET"});if(!a.ok){v(`Failed to fetch repository details: ${a.status}`);return}t=await a.json(),y(a=>({...a,[e]:t})),b(t),w(!1)}catch(e){v(e instanceof Error?e.message:"An unknown error occurred")}_.current=!1},z=()=>{b(null),I([]),w(!0)},B=F>50,G=async()=>{if(k(!0),B){k(!1);return}try{await a(S)}catch(t){let e="An unknown error occurred";if(t&&"object"==typeof t&&"base"in t&&"string"==typeof t.base){if(t.base.startsWith("unsupported_file_type")&&"files"in t){let a=t.files;if(1===a.length)e=`This file can't be submitted: ${a[0]}. Only supported file types are allowed.`;else{let[t,n]=[a.slice(0,3),a.slice(3)];e="One or more files can't be submitted: "+t.map(e=>(function(e,t=30){let a=e.length<=t?e:`...${e.slice(e.length-t,e.length)}`;return`<b>${a}</b>`})(e)).join(", "),n.length>0?e+=`, and ${n.length} more.`:e+=".",e+=" Only supported file types are allowed."}}else e=t.base}e.startsWith("The size of the space exceeds the current limit")&&(e="The size of the space exceeds the current limit"),T(e)}finally{k(!1)}};async function q(){let e="";f&&(e=`owner:${f}`);let t=await (0,u.lS)(`/_filter/repositories?q=${encodeURIComponent(e)}`);return t.ok?(await t.json()).repositories.map(e=>({name:e.nameWithOwner,enabled:!0,id:e.id})):[]}return(0,m.useEffect)(()=>{T(null)},[S]),p?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)($.X1,{selectionVariant:"instant",open:!C&&j,onOpenChange:e=>{_.current||(w(e),t())},selectedRepoIds:new Set,onSelectRepo:async e=>{e&&(I([]),await U(e))},cancelReturnFocusRef:h,submitReturnFocusRef:h,error:g??void 0,ownerDisplayLogin:f}),C&&(0,n.jsx)(l.l,{onClose:t,title:`Add files from ${C.ownerLogin}/${C.name}`,sx:{maxHeight:"600px","@media screen and (max-width: 768px)":{maxHeight:"unset"}},width:"large",position:{narrow:"fullscreen"},renderHeader:({onClose:e})=>(0,n.jsxs)(l.l.Header,{children:[(0,n.jsxs)("div",{className:ep.dialogHeader,children:[(0,n.jsx)(i.K,{icon:d.ArrowLeftIcon,"aria-label":"Back",onClick:z,variant:"invisible"})," ",(0,n.jsx)(l.l.Title,{children:"Select folders and files"}),(0,n.jsx)(eg,{onClose:()=>e("close-button")})]}),(0,n.jsx)(l.l.Subtitle,{className:"mt-0",children:(0,n.jsx)(L.d,{repository:C,children:(0,n.jsx)(D.Ck,{children:(0,n.jsx)(M.qV,{refInfo:{name:C.refInfo.name,canEdit:!0,listCacheKey:"anything",currentOid:C.commitOID},path:"test",action:"tree",copilotAccessAllowed:!0,children:(0,n.jsx)(W.$,{allShortcutsEnabled:!1,children:(0,n.jsx)(el,{commitOid:C.commitOID,findFileWorkerPath:r,onItemSelected:e=>{e&&O(e)},config:{enableOverlay:!0,disableNavigation:!0,searchPlaceholder:"Search for files or folders",actionText:"Search for files or folders"}})})})})})})]}),renderFooter:()=>(0,n.jsxs)(l.l.Footer,{children:[(0,n.jsx)("div",{className:"d-flex flex-items-center",children:B?(0,n.jsxs)(o.A.Validation,{variant:"error",children:["Up to ",50," files can be added at a time."]}):!ef.W.customCopilotsRedesign&&E?(0,n.jsx)(o.A.Validation,{variant:"error",children:E}):null}),(0,n.jsxs)("div",{className:"d-flex flex-row flex-justify-end gap-2",children:[(0,n.jsx)(s.Q,{onClick:t,children:"Cancel"}),(0,n.jsx)(s.Q,{...(0,V.G)("save-resource-button"),variant:"primary",onClick:G,count:N?void 0:F||void 0,loading:N,children:"Add"})]})]}),renderBody:()=>(0,n.jsxs)("div",{className:"d-flex flex-column",children:[g&&(0,n.jsx)("span",{children:g}),ef.W.customCopilotsRedesign&&E&&(0,n.jsx)("div",{className:"position-sticky top-0 bgColor-default flash-banner",children:(0,n.jsx)(c.A,{full:!0,variant:"danger",children:(0,n.jsx)(ex.yx,{as:"span",html:E})})}),(0,n.jsx)(L.d,{repository:C,children:(0,n.jsx)(D.Ck,{children:(0,n.jsx)(M.qV,{refInfo:{name:C.refInfo.name,canEdit:!0,listCacheKey:"anything",currentOid:C.commitOID},path:"test",action:"tree",copilotAccessAllowed:!0,children:(0,n.jsx)("div",{className:"p-2",children:(0,n.jsx)(ey,{expandedPath:A,currentRepo:C,localFormData:S,setLocalFormData:I,onFileCountChange:P,fetchError:g,processingTime:R})})})})})]})})]}):(0,n.jsx)(l.l,{onClose:t,title:C?`Add files from ${C.ownerLogin}/${C.name}`:"Add files",sx:{maxHeight:"500px"},renderHeader:({onClose:e})=>(0,n.jsxs)(l.l.Header,{children:[(0,n.jsxs)("div",{className:"d-flex flex-justify-between flex-items-center px-2",children:[(0,n.jsx)(l.l.Title,{children:C?`Add files from ${C.ownerLogin}/${C.name}`:"Add files"}),(0,n.jsx)(eg,{onClose:()=>e("close-button")})]}),(0,n.jsx)(l.l.Subtitle,{children:C&&(0,n.jsx)(L.d,{repository:C,children:(0,n.jsx)(D.Ck,{children:(0,n.jsx)(M.qV,{refInfo:{name:C.refInfo.name,canEdit:!0,listCacheKey:"anything",currentOid:C.commitOID},path:"test",action:"tree",copilotAccessAllowed:!0,children:(0,n.jsx)(W.$,{allShortcutsEnabled:!1,children:(0,n.jsx)(el,{commitOid:C.commitOID,findFileWorkerPath:r,onItemSelected:e=>{e&&O(e)},config:{enableOverlay:!0,disableNavigation:!0,searchPlaceholder:"Search",actionText:"Search for files or folders"}})})})})})})]}),renderFooter:()=>(0,n.jsxs)(l.l.Footer,{children:[(0,n.jsx)("div",{className:"d-flex flex-items-center",children:B?(0,n.jsxs)(o.A.Validation,{variant:"error",children:["A maximum of ",50," files can be added."]}):E?(0,n.jsx)(o.A.Validation,{variant:"error",children:E}):null}),(0,n.jsxs)("div",{className:"d-flex flex-row flex-justify-end gap-2",children:[(0,n.jsx)(s.Q,{onClick:t,children:"Cancel"}),(0,n.jsx)(s.Q,{...(0,V.G)("save-resource-button"),variant:"primary",onClick:G,count:N?void 0:F||void 0,loading:N,children:"Add"})]})]}),children:(0,n.jsxs)("div",{className:"d-flex flex-column",children:[g&&(0,n.jsx)("span",{children:g}),!C&&(0,n.jsx)(eh.P,{repositoryLoader:q,selectionVariant:"single",selectAllOption:!1,currentSelection:void 0,onSelect:e=>{e&&(I([]),U(e.id))},buttonText:S[0]?.nwo||"Select repository"}),C&&(0,n.jsx)(L.d,{repository:C,children:(0,n.jsx)(D.Ck,{children:(0,n.jsx)(M.qV,{refInfo:{name:C.refInfo.name,canEdit:!0,listCacheKey:"anything",currentOid:C.commitOID},path:"test",action:"tree",copilotAccessAllowed:!0,children:(0,n.jsx)(ey,{expandedPath:A,currentRepo:C,localFormData:S,setLocalFormData:I,onFileCountChange:P,fetchError:g,processingTime:R})})})})]})})}try{ey.displayName||(ey.displayName="FilePickerForm")}catch{}try{eg.displayName||(eg.displayName="CloseButton")}catch{}try{ev.displayName||(ev.displayName="MultiFilePicker")}catch{}},26556:(e,t,a)=>{a.d(t,{P:()=>d,w:()=>u});var n=a(74848),r=a(96540),i=a(38621),l=a(30631),o=a(55847),s=a(70170),c=a(3893);function d({currentSelection:e,repositoryLoader:t,onSelect:a,selectionVariant:d,selectAllOption:u,additionalButtonProps:m,buttonText:h=""}){let[p,f]=(0,r.useState)(""),[x,y]=(0,r.useState)([]),[g,v]=(0,r.useState)(!0),C=(0,r.useCallback)((0,s.s)(async e=>{try{let a=await t(e);y(a)}catch{}v(!1)},200),[t,y,v]);(0,r.useEffect)(()=>{v(!0),C(p)},[p,C,v]);let b=(0,r.useCallback)(e=>{"single"===d?!e[0]||e[0]._all?a(void 0):a(e[0]):a(e)},[d,a]),j=(0,r.useMemo)(()=>"multiple"===d?e||[]:e?[e]:[],[d,e]),w=(0,r.useCallback)(e=>{let t;return(e.name.length>24&&(t=`${e.name.substring(0,24)}...`),e._all)?{id:e.name,text:"All repositories",source:e,groupId:"all"}:{id:e.name,text:t||e.name,source:e,appendOnly:!1,groupId:"select",disabled:!1===e.enabled,leadingVisual:()=>e.private?(0,n.jsx)(i.RepoLockedIcon,{size:16}):(0,n.jsx)(i.RepoIcon,{size:16})}},[]),S=(0,r.useCallback)(e=>e.name,[]),I=(0,r.useMemo)(()=>{let e=[];e.push(...x);let t=j.filter(t=>e.every(e=>e.name!==t.name))||[];return e.push(...t),u&&e.push({name:"$all$",_all:!0}),e},[x,u,j]),R=h,N=i.RepoIcon;return R||("multiple"===d?R=j.length>0?`${j.length} repositor${j.length>1?"ies":"y"}`:"Select repositories":j.length>0&&j[0]?(R=j[0].name,N=j[0].private?i.RepoLockedIcon:i.RepoIcon):R=u?"All repositories":"Select a repository"),(0,n.jsx)(c.O,{renderAnchor:({"aria-labelledby":e,...t})=>(0,n.jsx)(o.Q,{leadingVisual:N,trailingAction:i.TriangleDownIcon,"aria-labelledby":` ${e}`,...t,...m,children:(0,n.jsx)(l.A,{title:R,maxWidth:195,children:R})}),placeholderText:"Repos",items:I,loading:g,groups:u?[{groupId:"all"},{groupId:"select"}]:[],selectionVariant:d,initialSelectedItems:j,onSelectionChange:b,filterItems:f,getItemKey:S,convertToItemProps:w})}function u(e){return async t=>{let a=t.trim().toLowerCase();return a?e.filter(e=>e.name.toLowerCase().includes(a)||e.name.toLowerCase().includes(a)):e}}try{d.displayName||(d.displayName="ReposSelector")}catch{}},61663:(e,t,a)=>{a.d(t,{Gy:()=>c,LB:()=>p,nn:()=>f,lm:()=>m});var n=a(74848),r=a(96540);let i=null,l=null,o=new Set;function s(e){return o.add(e),i||(i=new ResizeObserver(()=>{l||(l=requestAnimationFrame(()=>{for(let e of(l=null,o))e()}))})).observe(document.documentElement),()=>{o.delete(e),0===o.size&&i&&(i.disconnect(),i=null)}}let c={small:1,medium:544,large:768,xlarge:1012,xxlarge:1280,xxxlarge:1350,xxxxlarge:1440},d=[c.xxxxlarge,c.xxxlarge,c.xxlarge,c.xlarge,c.large,c.medium,c.small],u=r.createContext({screenSize:c.small});function m(){return r.useContext(u)}function h(){return f(window.innerWidth)}function p({children:e,initialValue:t=c.small}){let a=(0,r.useSyncExternalStore)(s,h,(0,r.useCallback)(()=>t,[t])),i=(0,r.useMemo)(()=>({screenSize:a}),[a]);return(0,n.jsx)(u.Provider,{value:i,children:e})}function f(e){for(let t of d)if(e>=t)return t;return c.small}try{u.displayName||(u.displayName="ScreenContext")}catch{}try{p.displayName||(p.displayName="ScreenSizeProvider")}catch{}},37824:(e,t,a)=>{a.d(t,{x:()=>h});var n=a(74848),r=a(38621),i=a(75177),l=a(6869),o=a(34614),s=a(89323),c=a(15385),d=a(47767);let u={Box:"SingleSignOnBanner-module__Box--iwIEO",Flash:"SingleSignOnBanner-module__Flash--XK1g3",Box_1:"SingleSignOnBanner-module__Box_1--VPBly",Octicon:"SingleSignOnBanner-module__Octicon--JXNw_",Box_2:"SingleSignOnBanner-module__Box_2--kq0MT",ForceWrap:"SingleSignOnBanner-module__ForceWrap--tZqOV",Paragraph:"SingleSignOnBanner-module__Paragraph--rpV0k"};var m=a(34164);function h({className:e,portalContainerName:t,protectedOrgs:a,maxVisibleOrgNames:s=3,redirectURI:c,useFullWidthStyle:h,forceWrap:x,sx:y}){let g=(0,d.zy)();if(!a||0===a.length)return null;let v=Math.max(0,a.length-s),C=1===a.length||v>0?(0,n.jsx)("b",{children:a.slice(0,s).join(", ")}):(0,n.jsxs)("span",{children:[(0,n.jsx)("b",{children:a.slice(0,a.length-1).join(", ")}),a.length>2&&","," and ",(0,n.jsx)("b",{children:a[a.length-1]})]});return(0,n.jsx)(i.A,{sx:y,className:e,"data-testid":"sso-banner",children:(0,n.jsx)("div",{className:u.Box,children:(0,n.jsx)("section",{"aria-label":"Single sign-on information",children:(0,n.jsx)(l.A,{sx:{borderRadius:h?0:2,borderWidth:h?"1px 0":1},className:u.Flash,children:1===a.length?(0,n.jsxs)("div",{children:[(0,n.jsx)(r.ShieldLockIcon,{}),(0,n.jsx)(o.A,{inline:!0,href:`/orgs/${a[0]}/sso?return_to=${f({location:g,redirectURI:c})}`,children:"Single sign-on"})," ","to see results in the ",(0,n.jsx)("b",{children:a[0]})," organization."]}):(0,n.jsxs)("div",{className:u.Box_1,children:[(0,n.jsx)(r.ShieldLockIcon,{className:u.Octicon}),(0,n.jsxs)("div",{className:(0,m.$)(u.Box_2,x&&u.ForceWrap),children:[(0,n.jsxs)("p",{className:u.Paragraph,children:["Single sign-on to see results in ",0===v&&"the ",s>0&&(0,n.jsxs)(n.Fragment,{children:[C," "]}),v>0&&(0,n.jsxs)(n.Fragment,{children:[s>0&&"and ",v," other"," "]}),a.length>1&&1!==v?"organizations":"organization","."]}),(0,n.jsx)("div",{style:{flexShrink:0},children:(0,n.jsx)(p,{portalContainerName:t,protectedOrgs:a,redirectURI:c})})]})]})})})})})}function p({portalContainerName:e,protectedOrgs:t,redirectURI:a}){let r=(0,d.zy)();return(0,n.jsxs)(s.W,{children:[(0,n.jsx)(s.W.Button,{size:"small",children:"Select an organization"}),(0,n.jsx)(s.W.Overlay,{portalContainerName:e,children:(0,n.jsx)(c.l,{children:t.map(e=>(0,n.jsx)(c.l.Item,{onSelect:()=>window.location.href=`/orgs/${encodeURIComponent(e)}/sso?return_to=${f({location:r,redirectURI:a})}`,children:e},`org-${e}`))})})]})}function f({location:e,redirectURI:t}){return encodeURIComponent(t?t(e):e.pathname+e.search+e.hash)}try{h.displayName||(h.displayName="SingleSignOnBanner")}catch{}try{p.displayName||(p.displayName="SingleSignOnButton")}catch{}}}]);
//# sourceMappingURL=ui_packages_custom-copilots_components_MultiFilePicker_tsx-cbe8a0f5f5e3.js.map